#!/bin/bash

# ğŸš€ LLM Classroom ìë™ ì‹œì‘ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ (í†µí•© ë²„ì „)
# ê¸°ì¡´ ê°œë³„ LaunchAgentë“¤ì„ í†µí•©ëœ í•˜ë‚˜ë¡œ êµì²´

echo "ğŸ”§ LLM Classroom ìë™ ì‹œì‘ ì„¤ì •..."
echo "=================================="

# ê¸°ì¡´ ê°œë³„ ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ì œê±°
echo "1. ê¸°ì¡´ ê°œë³„ ì„œë¹„ìŠ¤ ì •ë¦¬ ì¤‘..."
for service in hub proto1 proto3 proto4 cloudflared platform-v2; do
    launchctl unload ~/Library/LaunchAgents/com.llmclassroom.$service.plist 2>/dev/null || true
    launchctl unload ~/Library/LaunchAgents/com.llmclass.$service.plist 2>/dev/null || true
done

# ê¸°ì¡´ plist íŒŒì¼ ë°±ì—…
echo "2. ê¸°ì¡´ ì„¤ì • íŒŒì¼ ë°±ì—…..."
mkdir -p archive/launchd
mv ~/Library/LaunchAgents/com.llmclassroom.*.plist archive/launchd/ 2>/dev/null || true
mv ~/Library/LaunchAgents/com.llmclass.*.plist archive/launchd/ 2>/dev/null || true

# ìƒˆë¡œìš´ í†µí•© LaunchAgent ì„¤ì¹˜
echo "3. í†µí•© ì„œë¹„ìŠ¤ ì„¤ì •..."
cp config/launchd/com.llmclassroom.unified.plist ~/Library/LaunchAgents/

# ê¶Œí•œ ì„¤ì •
chmod 644 ~/Library/LaunchAgents/com.llmclassroom.unified.plist

# ì„œë¹„ìŠ¤ ë“±ë¡ ë° ì‹œì‘
echo "4. ì„œë¹„ìŠ¤ ì‹œì‘..."
launchctl load ~/Library/LaunchAgents/com.llmclassroom.unified.plist

# ì ì‹œ ëŒ€ê¸° í›„ ìƒíƒœ í™•ì¸
sleep 5
echo "5. ìƒíƒœ í™•ì¸..."
./llmclass status

echo ""
echo "âœ… ì„¤ì • ì™„ë£Œ!"
echo ""
echo "ì´ì œ ì‹œìŠ¤í…œ ì¬ë¶€íŒ… ì‹œ ìë™ìœ¼ë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë©ë‹ˆë‹¤."
echo ""
echo "ìˆ˜ë™ ì œì–´ ë°©ë²•:"
echo "  ./llmclass start    # ì‹œì‘"
echo "  ./llmclass stop     # ì¤‘ì§€"
echo "  ./llmclass status   # ìƒíƒœ í™•ì¸"
echo ""